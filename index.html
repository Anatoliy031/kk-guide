<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>–ö—É–¥–∞ –ø–æ–µ—Ö–∞—Ç—å ‚Äî –ö—Ä–∞—Å–Ω–æ–¥–∞—Ä—Å–∫–∏–π –∫—Ä–∞–π | –î–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä—ã</title>
  <meta name="description" content="–ü–æ–ª–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥ –¥–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π –ö—Ä–∞—Å–Ω–æ–¥–∞—Ä—Å–∫–æ–≥–æ –∫—Ä–∞—è –∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–æ–≤ —Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤. –ö–∞—Ä—Ç–∞, —Ñ–∏–ª—å—Ç—Ä—ã, –ø–æ–∏—Å–∫, —á—Ç–æ —Ä—è–¥–æ–º." />
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 128 128'%3E%3Ccircle cx='64' cy='64' r='64' fill='%230033A0'/%3E%3Cpath fill='%23fff' d='M34 80c16-10 44-10 60 0l-6 10c-13-8-35-8-48 0zM54 40a10 10 0 1 0 20 0a10 10 0 1 0-20 0z'/%3E%3C/svg%3E" />
  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script> tailwind.config={ theme:{ extend:{ colors:{ rs:'#0033A0', accent:'#00B4F0', ink:'#0B1A2B', soft:'#F5F7FB'} } } } </script>
  <!-- Leaflet + MarkerCluster -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css">
  <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
  <!-- Fuse.js (–ø–æ–∏—Å–∫) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.6.2/fuse.min.js"></script>

  <style>
    :root{ --rs:#0033A0; --accent:#00B4F0; --ink:#0B1A2B; --soft:#F5F7FB; }
    html,body{height:100%;}
    .glass{backdrop-filter:saturate(140%) blur(8px); background:rgba(255,255,255,.75); }
    .tag{display:inline-block;padding:.25rem .5rem;border-radius:9999px;border:1px solid #E5EEF8;background:#fff;font-size:.75rem}
    .btn{display:inline-flex;align-items:center;gap:.5rem;border-radius:.75rem;padding:.6rem .9rem;font-weight:600}
    .btn-primary{background:var(--rs);color:#fff}
    .btn-outline{border:1px solid #dbe5f2;background:#fff}
    .badge{font-size:.7rem;background:#E8F3FF;color:#0b3b8a;border:1px solid #CFE6FF;border-radius:.5rem;padding:.2rem .5rem}
    #map{height:60vh; min-height:420px; border-radius:1rem; border:1px solid #e8edf5}
    .card{border:1px solid #e8edf5;border-radius:1rem;background:#fff}
    .sticky-header{position:sticky;top:0;z-index:40}
    .fav{cursor:pointer}
    .shadow-soft{box-shadow:0 10px 30px rgba(0,0,0,.06)}
    .geomsg{font-size:.85rem;color:#38556e}
  </style>
</head>
<body class="bg-soft text-[15px] text-ink">
<header class="sticky-header glass border-b border-slate-200">
  <div class="max-w-7xl mx-auto px-4 py-3 flex items-center gap-3">
    <div class="w-9 h-9 rounded-full bg-rs flex items-center justify-center text-white font-black">–ö–ö</div>
    <div class="flex-1">
      <h1 class="text-xl font-extrabold text-rs leading-tight">–ö—É–¥–∞ –ø–æ–µ—Ö–∞—Ç—å ‚Äî –ö—Ä–∞—Å–Ω–æ–¥–∞—Ä—Å–∫–∏–π –∫—Ä–∞–π</h1>
      <p class="text-slate-600">–î–æ—Å—Ç–æ–ø—Ä–∏–º–µ—á–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –º–∞—Ä—à—Ä—É—Ç—ã –∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–æ–≤</p>
    </div>
    <button id="installBtn" class="btn btn-outline hidden" title="–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–∞–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ">üì≤ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
    <a class="btn btn-outline" href="#" id="exportCsv">‚¨áÔ∏è –≠–∫—Å–ø–æ—Ä—Ç CSV</a>
    <a class="btn btn-primary" href="#add">‚ûï –î–æ–±–∞–≤–∏—Ç—å –æ–±—ä–µ–∫—Ç</a>
  </div>
</header>

<main class="max-w-7xl mx-auto px-4 space-y-6 py-6">
  <!-- –ü–∞–Ω–µ–ª—å -->
  <section class="card p-4 shadow-soft">
    <div class="grid md:grid-cols-4 gap-3">
      <div class="md:col-span-2">
        <label class="text-xs text-slate-500">–ü–æ–∏—Å–∫</label>
        <input id="q" class="w-full border rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-accent" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: ‚Äò–°–∞—Ñ–∞—Ä–∏-–ø–∞—Ä–∫‚Äô, ‚Äò–¥–∂–∏–ø–∏–Ω–≥‚Äô, ‚Äò–ê–±—Ä–∞—É‚Äô...">
      </div>
      <div>
        <label class="text-xs text-slate-500">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
        <select id="cat" class="w-full border rounded-lg px-3 py-2">
          <option value="">–í—Å–µ</option>
          <option>–ü—Ä–∏—Ä–æ–¥–∞</option>
          <option>–ü–∞—Ä–∫–∏/–∞—Ç—Ç—Ä–∞–∫—Ü–∏–æ–Ω—ã</option>
          <option>–ò—Å—Ç–æ—Ä–∏—è/–º—É–∑–µ–∏</option>
          <option>–ì–æ—Ä–Ω–æ–ª—ã–∂–Ω—ã–π –∫–ª–∞—Å—Ç–µ—Ä</option>
          <option>–í–∏–Ω–Ω—ã–µ —Ç—É—Ä—ã</option>
          <option>–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä/—Ç—É—Ä–æ–ø–µ—Ä–∞—Ç–æ—Ä</option>
        </select>
      </div>
      <div>
        <label class="text-xs text-slate-500">–†–∞–π–æ–Ω/–≥–æ—Ä–æ–¥</label>
        <select id="dist" class="w-full border rounded-lg px-3 py-2">
          <option value="">–õ—é–±–æ–π</option>
          <option>–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä</option><option>–°–æ—á–∏</option><option>–ê–¥–ª–µ—Ä</option><option>–ö—Ä–∞—Å–Ω–∞—è –ü–æ–ª—è–Ω–∞</option><option>–ì–µ–ª–µ–Ω–¥–∂–∏–∫</option><option>–ê–Ω–∞–ø–∞</option><option>–ù–æ–≤–æ—Ä–æ—Å—Å–∏–π—Å–∫</option><option>–¢–µ–º—Ä—é–∫</option><option>–¢—É–∞–ø—Å–µ</option><option>–ê–ø—à–µ—Ä–æ–Ω—Å–∫</option>
        </select>
      </div>
    </div>
    <div class="flex flex-wrap gap-2 mt-3">
      <button class="btn btn-outline" id="nearMe">üìç –ü–æ–∫–∞–∑–∞—Ç—å —Ä—è–¥–æ–º</button>
      <button class="btn btn-outline" id="reset">‚Ü∫ –°–±—Ä–æ—Å–∏—Ç—å</button>
      <span class="geomsg hidden" id="geoStatus">–û–ø—Ä–µ–¥–µ–ª—è–µ–º –≥–µ–æ–ø–æ–∑–∏—Ü–∏—é‚Ä¶</span>
    </div>
  </section>

  <!-- –ö–∞—Ä—Ç–∞ -->
  <section class="grid lg:grid-cols-3 gap-6">
    <div class="lg:col-span-2 card p-3 shadow-soft">
      <div id="map"></div>
      <div class="flex gap-2 mt-3">
        <label class="tag"><input id="toggleAttractions" type="checkbox" class="mr-1" checked> –û–±—ä–µ–∫—Ç—ã</label>
        <label class="tag"><input id="toggleOperators" type="checkbox" class="mr-1" checked> –û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä—ã</label>
        <label class="tag"><input id="toggleFavorites" type="checkbox" class="mr-1"> –ò–∑–±—Ä–∞–Ω–Ω–æ–µ</label>
      </div>
    </div>

    <!-- –°–ø–∏—Å–æ–∫ -->
    <aside class="card p-3 max-h-[60vh] overflow-auto shadow-soft" id="list"></aside>
  </section>

  <!-- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ -->
  <section id="add" class="card p-5 shadow-soft">
    <h2 class="text-lg font-bold mb-2">–î–æ–±–∞–≤–∏—Ç—å –æ–±—ä–µ–∫—Ç / –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞</h2>
    <p class="text-slate-600 mb-3">–§–æ—Ä–º–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ñ–∞–π–ª JSON, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –ø—Ä–∏—Å–ª–∞—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –∏–ª–∏ –ø—Ä–∏–ª–æ–∂–∏—Ç—å –≤ GitHub PR. –¢–∞–∫ –±–∞–∑–∞ –±—É–¥–µ—Ç —Ä–∞—Å—Ç–∏ –±–µ–∑ —Ö–∞–æ—Å–∞ –∏ –¥—É–±–ª–µ–π.</p>
    <form id="addForm" class="grid md:grid-cols-3 gap-3">
      <input required class="border rounded-lg px-3 py-2" name="name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
      <select class="border rounded-lg px-3 py-2" name="category">
        <option>–ü—Ä–∏—Ä–æ–¥–∞</option><option>–ü–∞—Ä–∫–∏/–∞—Ç—Ç—Ä–∞–∫—Ü–∏–æ–Ω—ã</option><option>–ò—Å—Ç–æ—Ä–∏—è/–º—É–∑–µ–∏</option>
        <option>–ì–æ—Ä–Ω–æ–ª—ã–∂–Ω—ã–π –∫–ª–∞—Å—Ç–µ—Ä</option><option>–í–∏–Ω–Ω—ã–µ —Ç—É—Ä—ã</option><option>–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä/—Ç—É—Ä–æ–ø–µ—Ä–∞—Ç–æ—Ä</option>
      </select>
      <input class="border rounded-lg px-3 py-2" name="district" placeholder="–†–∞–π–æ–Ω/–≥–æ—Ä–æ–¥">
      <input class="border rounded-lg px-3 py-2" name="lat" placeholder="–®–∏—Ä–æ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä 44.62)">
      <input class="border rounded-lg px-3 py-2" name="lon" placeholder="–î–æ–ª–≥–æ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä 38.04)">
      <input class="border rounded-lg px-3 py-2" name="phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω">
      <input class="border rounded-lg px-3 py-2" name="email" placeholder="Email">
      <input class="border rounded-lg px-3 py-2" name="site" placeholder="–°–∞–π—Ç (https://)">
      <input class="border rounded-lg px-3 py-2" name="whatsapp" placeholder="WhatsApp (—Å —Ü–∏—Ñ—Ä–∞–º–∏)">
      <input class="border rounded-lg px-3 py-2" name="tg" placeholder="Telegram (@user –∏–ª–∏ —Å—Å—ã–ª–∫–∞)">
      <input class="border rounded-lg px-3 py-2 md:col-span-3" name="address" placeholder="–ê–¥—Ä–µ—Å (–µ—Å–ª–∏ –µ—Å—Ç—å)">
      <textarea class="border rounded-lg px-3 py-2 md:col-span-3" name="desc" placeholder="–ö–æ—Ä–æ—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ" rows="3"></textarea>
      <div class="md:col-span-3 flex gap-2">
        <button class="btn btn-primary" type="submit">üíæ –°–∫–∞—á–∞—Ç—å JSON</button>
        <button class="btn btn-outline" type="button" id="clearForm">–û—á–∏—Å—Ç–∏—Ç—å</button>
      </div>
    </form>
  </section>

  <section class="text-slate-500 text-sm">
    <p>–î–∞–Ω–Ω—ã–µ ‚Äî –∏–∑ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤, –ø–æ–ø–æ–ª–Ω—è—é—Ç—Å—è. –ü—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –∑–∞–º–µ—á–∞–Ω–∏–π/–¥–æ–±–∞–≤–ª–µ–Ω–∏–π ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π —Ñ–æ—Ä–º—É –≤—ã—à–µ. –°–¥–µ–ª–∞–Ω–æ —Å –∑–∞–±–æ—Ç–æ–π –æ –ø—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫–∞—Ö ‚ù§Ô∏è</p>
  </section>
</main>

<footer class="py-8 text-center text-slate-500">
  ¬© 2025. –ö—Ä–∞—Å–Ω–æ–¥–∞—Ä—Å–∫–∏–π –∫—Ä–∞–π ‚Äî –ø—É—Ç–µ–≤–æ–¥–∏—Ç–µ–ª—å.
</footer>

<!-- === –î–ê–ù–ù–´–ï (—Å—Ç–∞—Ä—Ç–æ–≤—ã–π –Ω–∞–±–æ—Ä) === -->
<script id="DATA" type="application/json">
{
  "places":[
    {
      "id":"park_krasnodar",
      "name":"–ü–∞—Ä–∫ ¬´–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä¬ª (–ü–∞—Ä–∫ –ì–∞–ª–∏—Ü–∫–æ–≥–æ)",
      "category":"–ü–∞—Ä–∫–∏/–∞—Ç—Ç—Ä–∞–∫—Ü–∏–æ–Ω—ã",
      "district":"–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä",
      "lat":45.0337, "lon":39.0136,
      "address":"–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä, —É–ª. –†–∞–∑–≤–µ–¥—á–∏–∫–∞ –õ–µ–æ–Ω–æ–≤–∞, 1",
      "desc":"–ó–Ω–∞–∫–æ–≤—ã–π –≥–æ—Ä–æ–¥—Å–∫–æ–π –ø–∞—Ä–∫ –∏ –∞–º—Ñ–∏—Ç–µ–∞—Ç—Ä —Ä—è–¥–æ–º —Å–æ —Å—Ç–∞–¥–∏–æ–Ω–æ–º –§–ö ¬´–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä¬ª.",
      "contacts":{"phone":"+7 861 210-65-75","email":"info@parkkrasnodar.com","site":"https://www.parkkrasnodar.com","vk":"https://vk.com/officialparkkrasnodar"}
    },
    {
      "id":"sochi_np",
      "name":"–°–æ—á–∏–Ω—Å–∫–∏–π –Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–∞—Ä–∫ ‚Äî –¥–∏—Ä–µ–∫—Ü–∏—è",
      "category":"–ü—Ä–∏—Ä–æ–¥–∞",
      "district":"–°–æ—á–∏",
      "lat":43.591, "lon":39.723,
      "address":"–°–æ—á–∏, –ö—É—Ä–æ—Ä—Ç–Ω—ã–π –ø—Ä., 74",
      "desc":"–ö—Ä—É–ø–Ω–µ–π—à–∏–µ –ø—Ä–∏—Ä–æ–¥–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –ë–æ–ª—å—à–æ–≥–æ –°–æ—á–∏: –ê–≥—É—Ä—Å–∫–∏–µ –∏ –û—Ä–µ—Ö–æ–≤—Å–∫–∏–µ –≤–æ–¥–æ–ø–∞–¥—ã, –ê—Ö—É–Ω –∏ –¥—Ä.",
      "contacts":{"phone":"+7 862 265-8909","email":"forest_sochi@npsochi.ru","site":"https://npsochi.ru"}
    },
    {
      "id":"agurskiye",
      "name":"–ê–≥—É—Ä—Å–∫–∏–µ –≤–æ–¥–æ–ø–∞–¥—ã",
      "category":"–ü—Ä–∏—Ä–æ–¥–∞",
      "district":"–°–æ—á–∏",
      "lat":43.558, "lon":39.831,
      "address":"–•–æ—Å—Ç–∏–Ω—Å–∫–∏–π —Ä-–Ω, —É—Ä–æ—á–∏—â–µ –ê–≥—É—Ä–∞",
      "desc":"–ö–∞—Å–∫–∞–¥ –≤–æ–¥–æ–ø–∞–¥–æ–≤ –∏ –∫–∞–Ω—å–æ–Ω. –ü–æ–ø—É–ª—è—Ä–Ω—ã–π –ø–µ—à–∏–π –º–∞—Ä—à—Ä—É—Ç –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –°–æ—á–∏–Ω—Å–∫–æ–≥–æ –Ω–∞—Ü–ø–∞—Ä–∫–∞.",
      "contacts":{"site":"https://npsochi.ru"}
    },
    {
      "id":"akhun",
      "name":"–ì–æ—Ä–∞ –∏ –±–∞—à–Ω—è –ê—Ö—É–Ω",
      "category":"–ü—Ä–∏—Ä–æ–¥–∞",
      "district":"–°–æ—á–∏",
      "lat":43.550, "lon":39.820,
      "address":"–•–æ—Å—Ç–∏–Ω—Å–∫–∏–π —Ä-–Ω",
      "desc":"–ü–∞–Ω–æ—Ä–∞–º–Ω–∞—è –∫–∞–º–µ–Ω–Ω–∞—è –±–∞—à–Ω—è –Ω–∞ –≤–µ—Ä—à–∏–Ω–µ –≥–æ—Ä—ã –ê—Ö—É–Ω. –õ—É—á—à–∏–µ –≤–∏–¥—ã –Ω–∞ –ø–æ–±–µ—Ä–µ–∂—å–µ.",
      "contacts":{"site":"https://npsochi.ru"}
    },
    {
      "id":"riviera_sochi",
      "name":"–ü–∞—Ä–∫ ¬´–†–∏–≤—å–µ—Ä–∞¬ª, –°–æ—á–∏",
      "category":"–ü–∞—Ä–∫–∏/–∞—Ç—Ç—Ä–∞–∫—Ü–∏–æ–Ω—ã",
      "district":"–°–æ—á–∏",
      "lat":43.592, "lon":39.720,
      "address":"–≥. –°–æ—á–∏, —É–ª. –ï–≥–æ—Ä–æ–≤–∞, 1",
      "desc":"–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –ø–∞—Ä–∫ —Å –∞—Ç—Ç—Ä–∞–∫—Ü–∏–æ–Ω–∞–º–∏ –≤ —Ü–µ–Ω—Ç—Ä–µ –°–æ—á–∏.",
      "contacts":{"phone":"+7 862 264-33-77","email":"info@rivierasochi.ru","site":"https://rivierasochi.ru"}
    },
    {
      "id":"sochi_park",
      "name":"–°–æ—á–∏ –ü–∞—Ä–∫ (—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–∞—Ä–∫)",
      "category":"–ü–∞—Ä–∫–∏/–∞—Ç—Ç—Ä–∞–∫—Ü–∏–æ–Ω—ã",
      "district":"–ê–¥–ª–µ—Ä",
      "lat":43.404, "lon":39.954,
      "address":"–ò–º–µ—Ä–µ—Ç–∏–Ω—Å–∫–∞—è –Ω–∏–∑–º–µ–Ω–Ω–æ—Å—Ç—å",
      "desc":"–ö—Ä—É–ø–Ω–µ–π—à–∏–π —Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–∞—Ä–∫ —Å—Ç—Ä–∞–Ω—ã —Ä—è–¥–æ–º —Å –û–ª–∏–º–ø–∏–π—Å–∫–∏–º –ø–∞—Ä–∫–æ–º.",
      "contacts":{"phone":"8 800 100-33-39","site":"https://www.sochipark.ru"}
    },
    {
      "id":"olympic_pk",
      "name":"–û–ª–∏–º–ø–∏–π—Å–∫–∏–π –ø–∞—Ä–∫, –°–∏—Ä–∏—É—Å",
      "category":"–ü–∞—Ä–∫–∏/–∞—Ç—Ç—Ä–∞–∫—Ü–∏–æ–Ω—ã",
      "district":"–ê–¥–ª–µ—Ä",
      "lat":43.402, "lon":39.957,
      "address":"–ø–æ—Å. –°–∏—Ä–∏—É—Å",
      "desc":"–ê—Ä–µ–Ω—ã, –Ω–∞–±–µ—Ä–µ–∂–Ω—ã–µ, –ø–æ—é—â–∏–µ —Ñ–æ–Ω—Ç–∞–Ω—ã –∏ –°–æ—á–∏ –ê–≤—Ç–æ–¥—Ä–æ–º.",
      "contacts":{"site":"https://park.sochisirius.ru","extra":"https://sochiautodrom.ru"}
    },
    {
      "id":"skypark",
      "name":"Skypark AJ Hackett Sochi",
      "category":"–ü–∞—Ä–∫–∏/–∞—Ç—Ç—Ä–∞–∫—Ü–∏–æ–Ω—ã",
      "district":"–ê–¥–ª–µ—Ä",
      "lat":43.533, "lon":39.997,
      "address":"—Å. –ö–∞–∑–∞—á–∏–π –ë—Ä–æ–¥, —É–ª. –ö—Ä–∞—Å–Ω–æ—Ñ–ª–æ—Ç—Å–∫–∞—è, 54–∞",
      "desc":"–ü–æ–¥–≤–µ—Å–Ω–æ–π –º–æ—Å—Ç, –±–∞–Ω–¥–∂–∏ 207 –º, –∑–∏–ø–ª–∞–π–Ω—ã –≤ –ê—Ö—à—Ç—ã—Ä—Å–∫–æ–º —É—â–µ–ª—å–µ.",
      "contacts":{"site":"https://skypark.ru","phone":"+7 918 930-90-90"}
    },
    {
      "id":"rosa",
      "name":"–ö—É—Ä–æ—Ä—Ç ¬´–†–æ–∑–∞ –•—É—Ç–æ—Ä¬ª",
      "category":"–ì–æ—Ä–Ω–æ–ª—ã–∂–Ω—ã–π –∫–ª–∞—Å—Ç–µ—Ä",
      "district":"–ö—Ä–∞—Å–Ω–∞—è –ü–æ–ª—è–Ω–∞",
      "lat":43.671, "lon":40.297,
      "address":"—Å. –≠—Å—Ç–æ-–°–∞–¥–æ–∫",
      "desc":"–ö–∞–Ω–∞—Ç–Ω—ã–µ –¥–æ—Ä–æ–≥–∏, —Ç—Ä–µ–∫–∏–Ω–≥ –∏ –∫—Ä—É–≥–ª–æ–≥–æ–¥–∏—á–Ω—ã–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.",
      "contacts":{"phone":"8 800 5000-555","email":"order@rosakhutor.com","site":"https://rosakhutor.ru"}
    },
    {
      "id":"guamka",
      "name":"–ì—É–∞–º—Å–∫–æ–µ —É—â–µ–ª—å–µ (–ú–µ–∑–º–∞–π ‚Äî —É–∑–∫–æ–∫–æ–ª–µ–π–∫–∞)",
      "category":"–ü—Ä–∏—Ä–æ–¥–∞",
      "district":"–ê–ø—à–µ—Ä–æ–Ω—Å–∫",
      "lat":44.197, "lon":39.968,
      "address":"–°—Ç-—Ü–∞ –ì—É–∞–º–∫–∞",
      "desc":"–ñ–∏–≤–æ–ø–∏—Å–Ω—ã–π –∫–∞–Ω—å–æ–Ω, —Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∞—è —É–∑–∫–æ–∫–æ–ª–µ–π–∫–∞, –∫–∞–Ω–∞—Ç–Ω–∞—è –¥–æ—Ä–æ–≥–∞.",
      "contacts":{"phone":"+7 86152 2-74-85","email":"guamka2017@yandex.ru","site":"https://guamka-kuban.ru"}
    },
    {
      "id":"safari_gel",
      "name":"–°–∞—Ñ–∞—Ä–∏-–ø–∞—Ä–∫ –ì–µ–ª–µ–Ω–¥–∂–∏–∫",
      "category":"–ü–∞—Ä–∫–∏/–∞—Ç—Ç—Ä–∞–∫—Ü–∏–æ–Ω—ã",
      "district":"–ì–µ–ª–µ–Ω–¥–∂–∏–∫",
      "lat":44.553, "lon":38.130,
      "address":"–ú-4 –î–æ–Ω, 1511 –∫–º + 750 –º",
      "desc":"–†–µ–∞–±–∏–ª–∏—Ç–∞—Ü–∏–æ–Ω–Ω—ã–π —Ü–µ–Ω—Ç—Ä –¥–∏–∫–∏—Ö –∂–∏–≤–æ—Ç–Ω—ã—Ö, –∫–∞–Ω–∞—Ç–Ω–∞—è –¥–æ—Ä–æ–≥–∞.",
      "contacts":{"phone":"+7 989 160-06-42","site":"https://www.safari-park.ru","email":"safari-park@list.ru"}
    },
    {
      "id":"olimp_gel",
      "name":"–ì–æ—Ä–Ω—ã–π –ø–∞—Ä–∫ ¬´–û–ª–∏–º–ø¬ª (–∫–∞–Ω–∞—Ç–Ω–∞—è –¥–æ—Ä–æ–≥–∞)",
      "category":"–ü–∞—Ä–∫–∏/–∞—Ç—Ç—Ä–∞–∫—Ü–∏–æ–Ω—ã",
      "district":"–ì–µ–ª–µ–Ω–¥–∂–∏–∫",
      "lat":44.575, "lon":38.055,
      "address":"–ö—É–ø—Ä–∏—è–Ω–æ–≤–∞ —â–µ–ª—å, 1",
      "desc":"–ö–∞–Ω–∞—Ç–Ω–∞—è –¥–æ—Ä–æ–≥–∞, –∫–æ–ª–µ—Å–æ, –æ–∫–µ–∞–Ω–∞—Ä–∏—É–º ‚Äî —Å–µ–º–µ–π–Ω—ã–π –ø–∞—Ä–∫ –Ω–∞ –≤—ã—Å–æ—Ç–µ.",
      "contacts":{"phone":"+7 988 333-07-70","site":"https://park-olimp.ru"}
    },
    {
      "id":"sail_rock",
      "name":"–°–∫–∞–ª–∞ –ü–∞—Ä—É—Å, –ü—Ä–∞—Å–∫–æ–≤–µ–µ–≤–∫–∞",
      "category":"–ü—Ä–∏—Ä–æ–¥–∞",
      "district":"–ì–µ–ª–µ–Ω–¥–∂–∏–∫",
      "lat":44.438624, "lon":38.184573,
      "address":"–ü–æ—Å. –ü—Ä–∞—Å–∫–æ–≤–µ–µ–≤–∫–∞",
      "desc":"–í–∏–∑–∏—Ç-—Ç–æ—á–∫–∞ –ß–µ—Ä–Ω–æ–º–æ—Ä—Å–∫–æ–≥–æ –ø–æ–±–µ—Ä–µ–∂—å—è ‚Äî —Ç–æ–Ω–∫–∞—è —Å–∫–∞–ª–∞ —É –∫—Ä–æ–º–∫–∏ –º–æ—Ä—è.",
      "contacts":{}
    },
    {
      "id":"utrish",
      "name":"–ì–æ—Å–∑–∞–ø–æ–≤–µ–¥–Ω–∏–∫ ¬´–£—Ç—Ä–∏—à¬ª ‚Äî –≤–∏–∑–∏—Ç-—Ü–µ–Ω—Ç—Ä",
      "category":"–ü—Ä–∏—Ä–æ–¥–∞",
      "district":"–ê–Ω–∞–ø–∞",
      "lat":44.8947, "lon":37.3176,
      "address":"–ê–Ω–∞–ø–∞, —É–ª. –°–µ–≤–µ—Ä–Ω–∞—è, 41–í",
      "desc":"–†–µ–ª–∏–∫—Ç–æ–≤—ã–µ –º–æ–∂–∂–µ–≤–µ–ª–æ–≤—ã–µ –ª–µ—Å–∞, –±—É—Ö—Ç—ã –£—Ç—Ä–∏—à–∞, —ç–∫–æ—Ç—Ä–æ–ø—ã.",
      "contacts":{"phone":"+7 86133 7-07-79","email":"mail@zapovednik-utrish.ru","site":"https://zapovednik-utrish.ru"}
    },
    {
      "id":"abrau",
      "name":"–ê–±—Ä–∞—É-–î—é—Ä—Å–æ ‚Äî –≤–∏–Ω–Ω—ã–µ —Ç—É—Ä—ã",
      "category":"–í–∏–Ω–Ω—ã–µ —Ç—É—Ä—ã",
      "district":"–ù–æ–≤–æ—Ä–æ—Å—Å–∏–π—Å–∫",
      "lat":44.706, "lon":37.583,
      "address":"–ø. –ê–±—Ä–∞—É-–î—é—Ä—Å–æ",
      "desc":"–≠–∫—Å–∫—É—Ä—Å–∏–∏ –ø–æ –ø–æ–¥–≤–∞–ª–∞–º, –¥–µ–≥—É—Å—Ç–∞—Ü–∏–∏, –ø—Ä–æ–≥—É–ª–∫–∏ –ø–æ –æ–∑–µ—Ä—É –ê–±—Ä–∞—É.",
      "contacts":{"site":"https://abrau.ru","extra":"https://abrau.ru/tourism"}
    },
    {
      "id":"fanagoria",
      "name":"–§–∞–Ω–∞–≥–æ—Ä–∏—è ‚Äî –≤–∏–Ω–æ–¥–µ–ª—å–Ω—è –∏ —Ç—É—Ä—ã",
      "category":"–í–∏–Ω–Ω—ã–µ —Ç—É—Ä—ã",
      "district":"–¢–µ–º—Ä—é–∫",
      "lat":45.088, "lon":37.381,
      "address":"–ø. –°–µ–Ω–Ω–æ–π, —É–ª. –ú–∏—Ä–∞, 49",
      "desc":"–î–µ–≥—É—Å—Ç–∞—Ü–∏–∏, –≤–∏–Ω–Ω—ã–µ –ø–æ–≥—Ä–µ–±–∞, —ç–∫—Å–∫—É—Ä—Å–∏–∏ –ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤—É.",
      "contacts":{"site":"https://www.fanagoria.ru","phone":"+7 861 483-87-47"}
    },
    {
      "id":"malaya_zemlya",
      "name":"–ú–µ–º–æ—Ä–∏–∞–ª ¬´–ú–∞–ª–∞—è –ó–µ–º–ª—è¬ª",
      "category":"–ò—Å—Ç–æ—Ä–∏—è/–º—É–∑–µ–∏",
      "district":"–ù–æ–≤–æ—Ä–æ—Å—Å–∏–π—Å–∫",
      "lat":44.729, "lon":37.784,
      "address":"–ù–æ–≤–æ—Ä–æ—Å—Å–∏–π—Å–∫, –°—É–¥–∂—É–∫—Å–∫–∞—è –∫–æ—Å–∞, 1–ê",
      "desc":"–ó–Ω–∞–∫–æ–≤—ã–π –º–µ–º–æ—Ä–∏–∞–ª —Å –≥–∞–ª–µ—Ä–µ–µ–π –±–æ–µ–≤–æ–π —Å–ª–∞–≤—ã.",
      "contacts":{"site":"https://novomuseum.ru"}
    },
    {
      "id":"mikhail_kutuzov",
      "name":"–ú—É–∑–µ–π-–∫—Ä–µ–π—Å–µ—Ä ¬´–ú–∏—Ö–∞–∏–ª –ö—É—Ç—É–∑–æ–≤¬ª",
      "category":"–ò—Å—Ç–æ—Ä–∏—è/–º—É–∑–µ–∏",
      "district":"–ù–æ–≤–æ—Ä–æ—Å—Å–∏–π—Å–∫",
      "lat":44.724, "lon":37.769,
      "address":"–ù–∞–±. –ê–¥–º. –°–µ—Ä–µ–±—Ä—è–∫–æ–≤–∞, 2–ê",
      "desc":"–§–∏–ª–∏–∞–ª –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–≥–æ –≤–æ–µ–Ω–Ω–æ-–º–æ—Ä—Å–∫–æ–≥–æ –º—É–∑–µ—è –Ω–∞ –±–æ—Ä—Ç—É –∫—Ä–µ–π—Å–µ—Ä–∞.",
      "contacts":{"phone":"8 800 300-80-51","email":"navalmuseum_kbs@mil.ru","site":"https://navalmuseum.ru/filials/cruiser_mikhail_kutuzov"}
    },
    {
      "id":"gefest",
      "name":"–ì—Ä—è–∑–µ–≤–æ–π –≤—É–ª–∫–∞–Ω ¬´–ì–µ—Ñ–µ—Å—Ç¬ª",
      "category":"–ü—Ä–∏—Ä–æ–¥–∞",
      "district":"–¢–µ–º—Ä—é–∫",
      "lat":45.283, "lon":37.401,
      "address":"–¢–µ–º—Ä—é–∫, –ø–µ—Ä. –ü–µ—Å—á–∞–Ω—ã–π, 2/1",
      "desc":"–ö—É–ø–∞–Ω–∏–µ –≤ –ª–µ—á–µ–±–Ω–æ–π –≥—Ä—è–∑–∏ –Ω–∞ –≤–µ—Ä—à–∏–Ω–µ –≤—É–ª–∫–∞–Ω–∞.",
      "contacts":{"phone":"+7 918 054-02-01","site":"https://vulkan-gefest.ru"}
    },
    {
      "id":"krasnodar_tic",
      "name":"–¢–ò–¶ –≥–æ—Ä–æ–¥–∞ –ö—Ä–∞—Å–Ω–æ–¥–∞—Ä–∞ (—Ç—É—Ä–∏—Å—Ç-–∏–Ω—Ñ–æ)",
      "category":"–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä/—Ç—É—Ä–æ–ø–µ—Ä–∞—Ç–æ—Ä",
      "district":"–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä",
      "lat":45.035, "lon":38.975,
      "address":"–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä",
      "desc":"–¢—É—Ä–∏—Å—Ç—Å–∫–æ-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π —Ü–µ–Ω—Ç—Ä –≥–æ—Ä–æ–¥–∞.",
      "contacts":{"phone":"+7 861 218-97-77","email":"tic@krd.ru","site":"https://tourism.krd.ru"}
    }
  ],
  "operators":[
    {
      "id":"op_sochi_exc365",
      "name":"–≠–∫—Å–∫—É—Ä—Å–∏–∏ –°–æ—á–∏ ¬´–ö—Ä—É–≥–ª—ã–π –≥–æ–¥¬ª",
      "category":"–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä/—Ç—É—Ä–æ–ø–µ—Ä–∞—Ç–æ—Ä",
      "district":"–°–æ—á–∏",
      "lat":43.590,"lon":39.728,
      "address":"–°–æ—á–∏",
      "desc":"–ê–≤—Ç–æ, –º–æ—Ä—Å–∫–∏–µ –∏ –∞–∫—Ç–∏–≤–Ω—ã–µ —ç–∫—Å–∫—É—Ä—Å–∏–∏ –ø–æ –ë–æ–ª—å—à–æ–º—É –°–æ—á–∏.",
      "contacts":{"phone":"8 (800) 201-14-47","site":"https://excursions-sochi.ru"}
    },
    {
      "id":"op_yuzhnye_reg",
      "name":"–Æ–∂–Ω—ã–µ —Ä–µ–≥–∏–æ–Ω—ã ‚Äî –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä —Ç—É—Ä–æ–≤ –≤—ã—Ö–æ–¥–Ω–æ–≥–æ –¥–Ω—è",
      "category":"–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä/—Ç—É—Ä–æ–ø–µ—Ä–∞—Ç–æ—Ä",
      "district":"–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä",
      "lat":45.04,"lon":38.98,
      "address":"–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä",
      "desc":"–ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ —Ç—É—Ä–∫–ª—É–±—ã –∏ —Ç—É—Ä–æ–ø–µ—Ä–∞—Ç–æ—Ä—ã, –µ–¥–∏–Ω–∞—è –≤–∏—Ç—Ä–∏–Ω–∞ —Ç—É—Ä–æ–≤.",
      "contacts":{"site":"https://xn----ftbebcq4afiq2ji1a.xn--p1ai/krasnodar"}
    },
    {
      "id":"op_eos",
      "name":"–≠–û–° ‚Äî –∞–≤—Ç–æ–±—É—Å–Ω—ã–µ —Ç—É—Ä—ã –∏–∑ –ö—Ä–∞—Å–Ω–æ–¥–∞—Ä–∞",
      "category":"–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä/—Ç—É—Ä–æ–ø–µ—Ä–∞—Ç–æ—Ä",
      "district":"–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä",
      "lat":45.04,"lon":38.98,
      "address":"–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä",
      "desc":"–û–¥–Ω–æ–¥–Ω–µ–≤–Ω—ã–µ —ç–∫—Å–∫—É—Ä—Å–∏–∏ –ø–æ –∫—Ä–∞—é, –º–Ω–æ–≥–æ–¥–Ω–µ–≤–Ω—ã–µ —Ç—É—Ä—ã.",
      "contacts":{"site":"https://eostour.ru"}
    },
    {
      "id":"op_riviera_sochi",
      "name":"–ú–£–ü ¬´–ü–∞—Ä–∫–∏ –æ—Ç–¥—ã—Ö–∞ –†–∏–≤—å–µ—Ä–∞-–°–æ—á–∏¬ª (—ç–∫—Å–∫—É—Ä—Å–∏–∏/–º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è)",
      "category":"–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä/—Ç—É—Ä–æ–ø–µ—Ä–∞—Ç–æ—Ä",
      "district":"–°–æ—á–∏",
      "lat":43.592,"lon":39.720,
      "address":"–°–æ—á–∏, —É–ª. –ï–≥–æ—Ä–æ–≤–∞, 1",
      "desc":"–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π –∏ —ç–∫—Å–∫—É—Ä—Å–∏–π –Ω–∞ –±–∞–∑–µ –ø–∞—Ä–∫–∞.",
      "contacts":{"phone":"+7 862 264-33-77","email":"info@rivierasochi.ru","site":"https://rivierasochi.ru"}
    },
    {
      "id":"op_abrau_tours",
      "name":"–ê–±—Ä–∞—É-–î—é—Ä—Å–æ ‚Äî —Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏–π —Ü–µ–Ω—Ç—Ä",
      "category":"–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä/—Ç—É—Ä–æ–ø–µ—Ä–∞—Ç–æ—Ä",
      "district":"–ù–æ–≤–æ—Ä–æ—Å—Å–∏–π—Å–∫",
      "lat":44.706,"lon":37.583,
      "address":"–ø. –ê–±—Ä–∞—É-–î—é—Ä—Å–æ",
      "desc":"–≠–∫—Å–∫—É—Ä—Å–∏–∏, –¥–µ–≥—É—Å—Ç–∞—Ü–∏–∏, –ø—Ä–æ–≥—É–ª–∫–∏ –Ω–∞ —Å–∞–ø–∞—Ö –∏ –ø–æ –æ–∑–µ—Ä—É.",
      "contacts":{"site":"https://abrau.ru/tourism"}
    },
    {
      "id":"op_fanagoria_tours",
      "name":"–§–∞–Ω–∞–≥–æ—Ä–∏—è ‚Äî —ç–∫—Å–∫—É—Ä—Å–∏–∏ –∏ –¥–µ–≥—É—Å—Ç–∞—Ü–∏–∏",
      "category":"–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä/—Ç—É—Ä–æ–ø–µ—Ä–∞—Ç–æ—Ä",
      "district":"–¢–µ–º—Ä—é–∫",
      "lat":45.088,"lon":37.381,
      "address":"–ø. –°–µ–Ω–Ω–æ–π, —É–ª. –ú–∏—Ä–∞, 49",
      "desc":"–≠–∫—Å–∫—É—Ä—Å–∏–∏ –ø–æ –≤–∏–Ω–æ–¥–µ–ª—å–Ω–µ, –¥–µ–≥—É—Å—Ç–∞—Ü–∏–∏, —ç–Ω–æ—Ç—É—Ä—ã.",
      "contacts":{"site":"https://www.fanagoria.ru/tourism/tours/","phone":"+7 861 483-87-47"}
    },
    {
      "id":"op_skypark",
      "name":"Skypark Sochi ‚Äî –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è/—ç–∫—Å–∫—É—Ä—Å–∏–∏",
      "category":"–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä/—Ç—É—Ä–æ–ø–µ—Ä–∞—Ç–æ—Ä",
      "district":"–ê–¥–ª–µ—Ä",
      "lat":43.533,"lon":39.997,
      "address":"—Å. –ö–∞–∑–∞—á–∏–π –ë—Ä–æ–¥",
      "desc":"–≠–∫—Å—Ç—Ä–∏–º-–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏, –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤—ã, —Å–≤–∞–¥—å–±—ã, —Ç—É—Ä—ã.",
      "contacts":{"site":"https://skypark.ru","phone":"+7 918 930-90-90"}
    },
    {
      "id":"op_guamka",
      "name":"–¢—É—Ä–∫–æ–º–ø–ª–µ–∫—Å ¬´–ì—É–∞–º–∫–∞¬ª",
      "category":"–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä/—Ç—É—Ä–æ–ø–µ—Ä–∞—Ç–æ—Ä",
      "district":"–ê–ø—à–µ—Ä–æ–Ω—Å–∫",
      "lat":44.197,"lon":39.968,
      "address":"–°—Ç-—Ü–∞ –ì—É–∞–º–∫–∞",
      "desc":"–ñ/–¥ –ø—Ä–æ–≥—É–ª–∫–∏ –≤ —É—â–µ–ª—å–µ, —ç–∫—Å–∫—É—Ä—Å–∏–∏, –ø–∏—Ç–∞–Ω–∏–µ.",
      "contacts":{"phone":"+7 86152 2-74-85","site":"https://guamka-kuban.ru"}
    }
  ]
}
</script>

<!-- === –ü–†–ò–õ–û–ñ–ï–ù–ò–ï === -->
<script>
  // --- PWA
  if('serviceWorker' in navigator){ window.addEventListener('load',()=>navigator.serviceWorker.register('./sw.js')); }
  let deferredPrompt; const ib=document.getElementById('installBtn');
  window.addEventListener('beforeinstallprompt',e=>{ e.preventDefault(); deferredPrompt=e; ib.classList.remove('hidden'); });
  ib?.addEventListener('click', async ()=>{ if(!deferredPrompt) return; deferredPrompt.prompt(); deferredPrompt=null; ib.classList.add('hidden'); });

  // --- DATA
  const DB = JSON.parse(document.getElementById('DATA').textContent);
  const ALL = [...DB.places.map(p=>({...p,type:'place'})), ...DB.operators.map(p=>({...p,type:'operator'}))];

  // --- MAP
  const map = L.map('map',{ zoomControl:true }).setView([44.9, 38.9], 7);
  const tiles = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
    maxZoom: 18, attribution:'¬© OpenStreetMap'
  }).addTo(map);
  const clusterPlaces = L.markerClusterGroup({ disableClusteringAtZoom: 14 });
  const clusterOps    = L.markerClusterGroup({ disableClusteringAtZoom: 14 });

  // Icons
  const iconBlue  = L.icon({iconUrl:'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png', iconSize:[25,41], iconAnchor:[12,41], popupAnchor:[1,-28]});
  const iconGold  = L.icon({iconUrl:'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png', iconSize:[25,41], iconAnchor:[12,41], popupAnchor:[1,-28]});

  const markers = {};
  function phoneLink(p){ return p ? `<a class="underline" href="tel:${p.replace(/[^+\d]/g,'')}">${p}</a>`:'' }
  function siteLink(s){ return s ? `<a class="underline" target="_blank" rel="noopener" href="${s}">${new URL(s).hostname}</a>`:'' }
  function waLink(n){ return n ? `<a class="underline" target="_blank" href="https://wa.me/${n.replace(/[^0-9]/g,'')}">WhatsApp</a>`:'' }
  function tgLink(t){ return t ? `<a class="underline" target="_blank" href="${t.startsWith('http')?t:`https://t.me/${t.replace('@','')}`}">Telegram</a>`:'' }
  function navLink(lat,lon){ return (lat && lon) ? `<a class="underline" target="_blank" href="https://yandex.ru/navi/?whatshere%5Bpoint%5D=${lon}%2C${lat}&whatshere%5Bzoom%5D=16&lang=ru&from=navi">–ù–∞–≤–∏–≥–∞—Ç–æ—Ä</a>`:'' }

  function makePopup(it){
    const c = it.contacts||{};
    return `
      <div class="text-sm">
        <div class="font-semibold">${it.name}</div>
        <div class="text-slate-600">${it.category} ‚Ä¢ ${it.district||''}</div>
        <div class="mt-1">${it.desc||''}</div>
        <div class="mt-2 flex flex-wrap gap-2">
          ${phoneLink(c.phone)} ${c.email?`<span>‚Ä¢</span> <a class="underline" href="mailto:${c.email}">${c.email}</a>`:''}
          ${c.site?`<span>‚Ä¢</span> ${siteLink(c.site)}`:''}
          ${c.whatsapp?`<span>‚Ä¢</span> ${waLink(c.whatsapp)}`:''}
          ${c.tg?`<span>‚Ä¢</span> ${tgLink(c.tg)}`:''}
          ${navLink(it.lat,it.lon)}
        </div>
      </div>`;
  }

  function addMarker(it){
    if(!it.lat || !it.lon) return;
    const marker = L.marker([it.lat,it.lon], { icon: it.type==='operator'?iconGold:iconBlue });
    marker.bindPopup(makePopup(it));
    markers[it.id]=marker;
    if(it.type==='operator') clusterOps.addLayer(marker); else clusterPlaces.addLayer(marker);
  }
  ALL.forEach(addMarker);
  map.addLayer(clusterPlaces); map.addLayer(clusterOps);

  // --- SEARCH + FILTERS
  const $q = document.getElementById('q'), $cat=document.getElementById('cat'), $dist=document.getElementById('dist');
  const $list = document.getElementById('list');
  const fuse = new Fuse(ALL,{ keys:['name','desc','category','district','address','contacts.phone','contacts.site'], threshold:.35 });

  const favKey='kk_favs_v1'; let FAVS=new Set(JSON.parse(localStorage.getItem(favKey)||'[]'));
  const $toggleA=document.getElementById('toggleAttractions'), $toggleO=document.getElementById('toggleOperators'), $toggleF=document.getElementById('toggleFavorites');

  function fits(it){
    if($toggleF.checked && !FAVS.has(it.id)) return false;
    if($cat.value && it.category!==$cat.value) return false;
    if($dist.value && (it.district||'')!==$dist.value) return false;
    if(!$toggleA.checked && it.type==='place') return false;
    if(!$toggleO.checked && it.type==='operator') return false;
    return true;
  }

  let userPos=null;
  function distanceKm(a,b){ const R=6371; const dLat=(b.lat-a.lat)*Math.PI/180, dLon=(b.lon-a.lon)*Math.PI/180;
    const lat1=a.lat*Math.PI/180, lat2=b.lat*Math.PI/180;
    const x = Math.sin(dLat/2)**2 + Math.cos(lat1)*Math.cos(lat2)*Math.sin(dLon/2)**2; return 2*R*Math.asin(Math.sqrt(x)); }

  function render(items){
    clusterPlaces.clearLayers(); clusterOps.clearLayers();
    $list.innerHTML='';
    items.forEach(it=>{
      if(!fits(it)) return;
      // show marker
      addMarker(it);
      const c=it.contacts||{}, isFav=FAVS.has(it.id);
      const dist = (userPos && it.lat && it.lon) ? `‚Ä¢ ${(distanceKm({lat:userPos[0],lon:userPos[1]},{lat:it.lat,lon:it.lon)).toFixed(1)} –∫–º` : '';
      const card = document.createElement('div');
      card.className='card p-3 mb-3';
      card.innerHTML=`
        <div class="flex items-start justify-between gap-3">
          <div>
            <div class="flex items-center gap-2">
              <span class="badge">${it.category}</span>
              ${it.type==='operator'?'<span class="badge">–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä</span>':''}
            </div>
            <h3 class="text-base font-bold mt-1">${it.name}</h3>
            <div class="text-slate-600">${it.district||''} ${dist}</div>
            <p class="mt-2">${it.desc||''}</p>
            ${it.address?`<div class="text-slate-500 mt-1">üìç ${it.address}</div>`:''}
            <div class="mt-2 flex flex-wrap gap-2">
              ${phoneLink(c.phone)} ${c.email?`<span>‚Ä¢</span> <a class="underline" href="mailto:${c.email}">${c.email}</a>`:''}
              ${c.site?`<span>‚Ä¢</span> ${siteLink(c.site)}`:''}
              ${c.whatsapp?`<span>‚Ä¢</span> ${waLink(c.whatsapp)}`:''}
              ${c.tg?`<span>‚Ä¢</span> ${tgLink(c.tg)}`:''}
              ${navLink(it.lat,it.lon)}
            </div>
          </div>
          <div class="flex flex-col items-end gap-2">
            <button class="fav text-xl" title="${isFav?'–í –∏–∑–±—Ä–∞–Ω–Ω–æ–º':'–í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ'}"> ${isFav?'‚≠êÔ∏è':'‚òÜ'} </button>
            ${it.lat&&it.lon?`<button class="btn btn-outline text-xs" data-goto="${it.id}">–ù–∞ –∫–∞—Ä—Ç–µ</button>`:''}
          </div>
        </div>`;
      $list.appendChild(card);
      // handlers
      card.querySelector('.fav').onclick=()=>{
        if(FAVS.has(it.id)){ FAVS.delete(it.id); } else { FAVS.add(it.id); }
        localStorage.setItem(favKey, JSON.stringify([...FAVS]));
        render(current);
      };
      const goto=card.querySelector('[data-goto]');
      if(goto) goto.onclick=()=>{ const m=markers[it.id]; if(m){ map.setView(m.getLatLng(), 15); m.openPopup(); } };
    });
  }

  let current=ALL;
  function apply(){
    const q=$q.value.trim();
    let result = ALL;
    if(q){ result=fuse.search(q).map(r=>r.item); }
    current = result;
    render(result);
  }

  $q.addEventListener('input', apply);
  $cat.onchange=apply; $dist.onchange=apply;
  $toggleA.onchange=apply; $toggleO.onchange=apply; $toggleF.onchange=apply;

  // –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è
  const $near=document.getElementById('nearMe'), $geo=document.getElementById('geoStatus');
  $near.onclick=()=>{
    $geo.classList.remove('hidden'); $geo.textContent='–û–ø—Ä–µ–¥–µ–ª—è–µ–º –≥–µ–æ–ø–æ–∑–∏—Ü–∏—é‚Ä¶';
    navigator.geolocation.getCurrentPosition(pos=>{
      userPos=[pos.coords.latitude, pos.coords.longitude];
      $geo.textContent='–ì–µ–æ–ø–æ–∑–∏—Ü–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ ‚úî';
      // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—é
      current = [...ALL].filter(fits).sort((a,b)=>{
        const da = (a.lat && a.lon) ? distanceKm({lat:userPos[0],lon:userPos[1]},{lat:a.lat,lon:a.lon}) : 9e9;
        const db = (b.lat && b.lon) ? distanceKm({lat:userPos[0],lon:userPos[1]},{lat:b.lat,lon:b.lon}) : 9e9;
        return da-db;
      });
      map.setView(userPos, 11);
      render(current);
    }, err=>{ $geo.textContent='–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –≥–µ–æ–ø–æ–∑–∏—Ü–∏—é'; setTimeout(()=>{$geo.classList.add('hidden')},2000); });
  };

  // –°–±—Ä–æ—Å
  document.getElementById('reset').onclick=()=>{
    $q.value=''; $cat.value=''; $dist.value=''; $toggleF.checked=false; $toggleA.checked=true; $toggleO.checked=true;
    apply();
  };

  // –≠–∫—Å–ø–æ—Ä—Ç CSV
  function toCsvRow(o, fields){ return fields.map(f=>JSON.stringify((o?.[f]??'').toString().replace(/\n/g,' '))).join(','); }
  document.getElementById('exportCsv').onclick=(e)=>{
    e.preventDefault();
    const fields=['id','type','name','category','district','lat','lon','address','desc','phone','email','site','whatsapp','tg'];
    const rows=[fields.join(',')];
    ALL.forEach(it=>{
      const c=it.contacts||{};
      const flat={...it, phone:c.phone||'', email:c.email||'', site:c.site||'', whatsapp:c.whatsapp||'', tg:c.tg||''};
      rows.push(toCsvRow(flat, fields));
    });
    const blob=new Blob([rows.join('\n')],{type:'text/csv;charset=utf-8;'});
    const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='krasnodar_travel_catalog.csv'; a.click();
  };

  // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ JSON
  document.getElementById('addForm').addEventListener('submit',(e)=>{
    e.preventDefault();
    const fd=new FormData(e.target); const obj=Object.fromEntries(fd.entries());
    const entry={
      id: 'custom_' + Math.random().toString(36).slice(2,9),
      name: obj.name, category: obj.category, district: obj.district||'',
      lat: obj.lat?Number(obj.lat):null, lon: obj.lon?Number(obj.lon):null,
      address: obj.address||'', desc: obj.desc||'',
      contacts: { phone:obj.phone||'', email:obj.email||'', site:obj.site||'', whatsapp:obj.whatsapp||'', tg:obj.tg||'' }
    };
    const blob=new Blob([JSON.stringify(entry,null,2)],{type:'application/json'});
    const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=`new_place_${entry.id}.json`; a.click();
  });
  document.getElementById('clearForm').onclick=()=>{ document.getElementById('addForm').reset(); };

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
  apply();
</script>
</body>
</html>
